# Kickoff meeting

## Attendees
- Jake Dawkins (Lead Engineer, Mobile - Major League Soccer)
- Peter Piekarczyk (Senior Jr. Developer - orchard.ai)
- Charles Mangwa (student developing a RN app)
- Jared Forsyth (Khan Academy)
- James Reggio (Convoy)
- Sashko Stubailo (Apollo)
- Peggy Rayzis (Apollo)

## Notes
- Project requirements
  - Jared
    - Integrating RN into an existing brownfield app
    - RN UI is fed the data from native DB but they want to switch to GraphQL
    - Cache everything you download
    - If it's less than a day old, don't hit the network
    - Data is a couple MB at the largest
    - Cache policies: LRU - least recently used cache, drop it if it hasnt been queried in the last week
    - Different caching strategies for different data
  - James
    - Using AsyncStorage with Apollo Client 2 already
    - Using extract/restore cache methods
    - Perf is an issue because of the data coming over the bridge
    - Persist when the app is in the background
    - AsyncStorage grows over time -- no easy way to prune stale data
      - Solved by setting a threshold
    - Hermes doesn't support extract & restore, can't use Hermes normalization strategy for RN cache since you can't serialize object refs
    - Serialize pending optimistic mutation results separately & restore them separately
  - Charles
    - Working on a cash register app, main purpose is to build something that works offline
    - Batching operations that execute once the client is back online
      - You can implement this via a link
  - Jake
    - Starting from scratch
    - Favorite club & personalization, things that affect UI on startup
    - User settings are a cool use case
    - Match schedule feed can be cached for a long time
  - Peter
    - Reusing some of the data that already exists
    - Use AsyncStorage for data that doesn't change over time
- Design discussion
  - Peter: Optimizing fragments
    - Split the data up into multiple queries if they need to be loaded separately
    - Get data from the offline store
  - Cross platform not incredibly important but could be down the line
  - Hybrid vs. fully persisted
    - AsyncStorage has the ability to write a diff to a key (merge an object onto an existing object, mergekeys)
    - If we wanted fully persisted, we could write a wrapper over apollo-ios & apollo-android
  - Brownfield vs. greenfield
    - Khan Academy - brownfield app but they dont want to move GraphQL to native
  - Expo: SQLLite, built in alternative to AsyncStorage. We should think of supporting these
  - Current API changes
    - Suggestion: Add listener to read & writeQuery
      - Let the InMemoryCache do the heavy lifting
      - Takes a store factory --> implement a store that tracks time
  - Normalization strategy
    - Everything needs to be JSON serializable
    - Store positional metadata (when was the most recent read)
  - Ideally we want fine grained cache management on the data you receive from the server
    - We should also think about client data for situations like user settings
  - Async cache
    - Async initalization, all reads wait for that
      - A lot of stuff assumes reads are synchronous
    - How does life progress if you have to wait for a read every time?? ðŸ˜‚
    - Now you have to worry about two loading states
  - Perf isn't as bad as we thought: iPhone 6 (1 MB = 300ms to load from AsyncStorage, writing is the same amount of time)
    - Loading on demand
- Next steps
  - Charles: online/offline link
  - Jared: LRU cache idea
  - James: open source extract/restore
  - Peter: happy to test & brainstorm
  - Jake: happy to jump in!
- Next meeting: Dec 13th at 9AM PST ðŸŽ‰

## Agenda
- Introductions (5 min)
- Project requirements (15 min)
  - How is your team using React Native? (greenfield, brownfield, etc)
  - How are you currently using AsyncStorage in your application?
  - What features are most important to you for a persisted cache?
- Design discussion (10 min)
  - Hybrid vs. full persisted cache
  - Should the component or operation decide the cache?
    - Decide via a directive or by specifying a name property?
  - Normalization strategy
    - Everything must be serialized since it has to go over the bridge
  - Cross-platform â€” is this important to people?
    - React Native Web supports AsyncStorage
    - What about local storage?
    - `AsyncStorage` is Async, `localStorage` is sync
- Apollo Cache API overview (5 min)
  - DataProxy
  - What do we need to implement?
  - [Hermes](https://github.com/convoyinc/apollo-cache-hermes): example of a custom community cache
- Building the cache (5 min)
  - Volunteer for building features
  - Documentation
  - Timeline
- Regular meeting cadence (5 min)
  - When & how often do you want to meet?
  - Timezones
